# MyDealTask

## .Net Solution Architecture

The architecture complies of separated projects that ensure a separation of concerns based on responsabilities. These projects are then grouped in folders considering the responsabilities they share and numbered in order of access (UI->database).

There is a folder Common which contains the elements that are used across the whole stack such as contracts, models, etc.

## Entity Framework Database first

Entity Framework 6 is being used as the solution ORM. The Model, Repositories and repositories interfaces are being auto generated from the EDMX using text templates which have been modified to deliver these different structures.

The model, which is being auto generated, include serialization and validation attributes and is included in the Model project which is used across the solution.

The data access repositories are implementing it's own interface in order to be injected as a dependency. Also they inherit from the IRepository interface in order for them to have all the repository access methods. These although are implemented in the BaseRepository generically.

## Dependency injection using unity

The solution implements a project based on the unity container to handle dependency injection smoothly by loading the dependencies from the dependency dll itself and resolving these from a dependency resolver class in the web api.

For the injection of the repositories the implemented interfaces in each repository are autogenerated from text templates inferred from the EF edmx generated.

## TDD for business logic processor

The logic behind the PNL processing has been implemented using TDD. The test cases were written in order to comply with the validation of each line and the result. Regular expressions were used to validate and process each line of the PNL, which is passed as a string reader and read line per line. The process file method defined in the interface returns a list of generic type which is then implemeted to return a list of the model defined.

By using this approach when testing the sumited test data incured in an error parsing one of the lines which had a differnt format from the others. This case was considered an error and was remediated by throwing an exception that indicates the line number and content.

## Web Api - Swagger

The web api task is to work as an HTTP rest interface to upload the NPLs and ........................

Swagger is being used as a means to test the api as well to expose the interface methods, parameters and response to the developers in order to implement clients that use it.


public class ImportFileParamType : IOperationFilter
    {
        [AttributeUsage(AttributeTargets.Method)]
        public sealed class SwaggerFormAttribute : Attribute
        {
            public SwaggerFormAttribute(string name, string description)
            {
                Name = name;
                Description = description;
            }
            public string Name { get; private set; }

            public string Description { get; private set; }
        }
        public void Apply(Operation operation, SchemaRegistry schemaRegistry, ApiDescription apiDescription)
        {
            var requestAttributes = apiDescription.GetControllerAndActionAttributes<SwaggerFormAttribute>();
            foreach (var attr in requestAttributes)
            {
                operation.parameters = operation.parameters ?? new List<Parameter>();
                operation.parameters.Add(new Parameter
                {
                    description = attr.Description,
                    name = attr.Name,
                    @in = "formData",
                    required = true,
                    type = "file",  
                });
                operation.consumes.Add("multipart/form-data");
            }
        }
    }

SWaggerconfig add

c.OperationFilter<ImportFileParamType>();
    
Controller 

[ImportFileParamType.SwaggerFormAttribute("PDF", "Upload pdf file")]
public IHttpActionResult Post(string applicationId, string documentCategory, string documentType/*, List<DocumentRequest> requests*/)
        {
            var files = GetFiles();
            if (files != null && files.Count > 0)
            {
                using (DocumentProcessor processor = new DocumentProcessor(Queue, Repository))
                {
                    processor.Process(new Document()
                    {
                        ApplicationId = applicationId,
                        DocumentCategory = documentCategory,
                        DocumentType = documentType,
                        Document = files.Get(0).InputStream
                    });
                }
            }
                
            return Ok(/*string.Join(",",requests.Select(d=>d.File))*/);
        }
    private HttpFileCollection GetFiles()
        {

            var httpRequest = HttpContext.Current.Request;
            if (httpRequest.Files.Count < 1)
            {
                return null;
            }

            return httpRequest.Files;
        }

## Angular 1-5 material design/bootstrap clients



The
